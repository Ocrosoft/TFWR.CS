# [中文版](README.zh.md)

# TFWR.CS

An automatic C# → Python-like code transpiler for the game *The Farmer Was Replaced*.

## Quick Start

### Usage

1. Download `SampleProject.zip` from [Releases](https://github.com/Ocrosoft/TFWR.CS/releases)
2. In the game, click the top-right corner to open the info window, go to the **"External Editor"** help page, and click the **"Save Folder"** button to open the save directory
3. Extract `SampleProject.zip` into the corresponding save directory (e.g. `Save0`)
4. Open `cs\SampleProject.sln` in your IDE for full code completion and type hints
5. Double-click `TFWR.CS\TFWR.CS.exe` to run the transpiler (requires [.NET 9 Runtime](https://dotnet.microsoft.com/download/dotnet/9.0))
6. The transpiler will watch `.cs` files in the `cs\` directory and generate `.py` files to the save root in real time

> Directory structure after extraction:
> ```
> Save0/
> ├── TFWR.CS/        # Transpiler
> │   └── TFWR.CS.exe         # Double-click to run
> ├── cs/              # C# source code (write code here)
> │   ├── Program.cs
> │   ├── SampleProject.csproj
> │   ├── SampleProject.sln
> │   ├── TFWR.CS.REF.dll     # Game API definitions (provides code completion)
> │   └── TFWR.CS.REF.xml     # API doc comments
> └── *.py          # Scripts auto-generated by transpiler (read by game)
> ```

### Build from Source

```bash
git clone https://github.com/Ocrosoft/TFWR.CS.git
cd TFWR.CS
dotnet build
```

## Collection Expression `[]` Type Inference

The transpiler lacks a full semantic model, so type inference for collection expressions `[]` is limited:

| Scenario | Supported | Example |
|---|---|---|
| Variable declaration init | ✅ | `List<int> x = [];` |
| Simple identifier assignment | ✅ | `x = [];` (x declared in current scope) |
| Method return value | ✅ | `return [];` (inferred from method signature) |
| Method argument | ❌ | `Method([]);` → use `Method(new List<int>())` instead |
| Property assignment | ❌ | `obj.Prop = [];` → use `obj.Prop = new()` instead |
| Complex expression | ❌ | `obj.Method().Prop = [];` |

When the type cannot be inferred, defaults to list `[]` with a warning.

## ❌ Unsupported Syntax and Features

The following syntax will be **ignored or produce errors** — avoid using:

- **Type system**: Inheritance, interfaces, abstract classes, sealed, enums, generic constraints, record, struct (treated as plain class, value semantics not preserved)
- **Advanced syntax**: Lambda, LINQ, ternary `? :`, `??`, `?.`, pattern matching (switch expressions / is patterns), range operators `..` / `^`
- **Exception handling**: try-catch-finally, throw
- **Async**: async/await, Task
- **Class members**: Property get/set logic (auto-properties are fine), indexers, operator overloading, extension methods, delegates, events
- **Parameter modifiers**: ref/out (syntax-only transpilation), in, params, named arguments
- **Other**: Attributes (ignored), preprocessor directives, namespaces (ignored), using directives (ignored), partial classes, yield return, dynamic, anonymous types

## Notes

- This project is still under development — for learning and entertainment only
- Debugging C# code is not supported; debug generated code inside the game
- Do not ignore list access method return values, or the game will throw errors
- Avoid using `List` constructors with parameters
- **Tuple return values do not support named field access** (e.g. `ret.x`) — use destructuring:
  ```csharp
  // ❌ Not supported
  var ret = GetPosition();
  var px = ret.x;

  // ✅ Correct
  var (x, y) = GetPosition();
  ```

## Disclaimer

This project is independently developed and has no affiliation with the official *The Farmer Was Replaced* game. Do not use this project for commercial purposes.
